github:
  on:
    push:
      branches:
        - master
    pull_request:

  workflows:
    lint:
      name: Dart Lint CI
      stages:
        - analyze

  on_completion:
    - name: "Notify failure"
      runs-on: self-hosted
      if: failure()
      steps:
        - run: >
            curl -H "Content-Type: application/json" -X POST -d \
              "{'text':'Build failed! ${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/actions/runs/${GITHUB_RUN_ID}'}" \
              "${CHAT_WEBHOOK_URL}"
          env:
            CHAT_WEBHOOK_URL: ${{ secrets.CHAT_WEBHOOK_URL }}

self_validate: analyze

# Use this key to merge stages across packages to create fewer jobs
merge_stages:
  - analyzer_and_format
